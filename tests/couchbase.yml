name: Couchbase Test Suite
vars:
  couchbase_dsn: localhost:8091
  couchbase_bucket: cards

testcases:
  - name: Insert some data
    steps:
      - type: couchbase
        cluster:
          dsn: "{{.couchbase_dsn}}"
          username: Administrator
          wait_until_ready: true
        bucket:
          name: "${{.couchbase_bucket}}"
          create_if_not_exists: true
          wait_until_ready: true
        must_ping_service: true
        actions:
          - type: get
            ids: ["foo", "bar"]
          - type: insert
            documents:
              foo: |
                {
                  "color": "black",
                  "value": "joker"
                }
              bar: |
                {
                  "color": "red",
                  "value": "joker"
                }
        info: "{{.result}}"
        assertions:
          - result.actions.actions0.inserted ShouldBeTrue
          - result.actions.actions0.id ShouldEqual "foo"
          - result.actions.actions1.inserted ShouldBeTrue
          - result.actions.actions1.id ShouldEqual "bar"